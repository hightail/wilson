/*** Wilson Client Framework  v3.1.0 -- Mon, 14 Aug 2017 23:46:35 GMT ***/

"use strict";!function(e,n,t){function o(e){function o(e,n){return e+t.upperFirst(t.camelCase(n))}function r(e){var n=p.app.selectors.component+"-"+t.kebabCase(e);return"<"+n+"></"+n+">"}function i(e,n,o){if(!t.isString(n))throw new Error(e+" name must be a string!!!");if(!e)throw new Error("Failed to validate definition params. Type is null or undefined!!");var r=null,i="component"===e?"controller":"primary";if(!t.isFunction(o)&&t.isEmpty(o)?r="definition is empty and cannot be processed.":t.isFunction(o)||t.isArray(o)||(r="definition must be a Function or an Array!!!"),r)throw new Error(e+" ["+n+"] "+i+" "+r)}function a(e,n,t){return["ComponentFactoryService","WilsonUtils","$scope","$element","$attrs",function(o,r,i,a,c){var s=l.getActiveComponent(l.findComponentId(a)),u=r.generateUUID();a.data("wilsonComponentId",u),K[u]=o.create(u,e,n,this,s,i,a,c,t),i.on.event("$destroy",function(){delete K[u]})}]}function c(e,n){var o=t.findIndex(e,{path:null});if(o===-1)throw new Error("Null route MUST be specified in routes!");if(o<e.length-1)throw new Error("Null route MUST be the last specified route!");t.each(e,function(t){u(t,e,n)})}function s(e,n){var o=t.find(n,{path:e});return o=o||t.find(n,{path:null}),o&&o.options?t.clone(o.options):{}}function u(e,o,i){if(!i)throw new Error("No RouteProvider included! Cannot create route!");if(t.isUndefined(e.path))throw new Error("Route information is invalid! Missing path definition: \n"+JSON.stringify(e,void 0,2));var a={controller:function(){E=e.component},template:r(e.component),componentName:e.component,resolve:{title:["$rootScope","WilsonRouter",function(n,o){return t.merge(n,{page:{title:o.getTitleText(e.title)}}),n.page.title}],component:["$route","$q","$location","$window","WilsonRouter","WilsonUtils","ComponentLoaderService",function(r,i,a,c,u,l,f){var p=a.path(),d=s(r.current.originalPath,o),h=t.extend({},d,e.defaultParams||{},r.current.params);return l.replaceObject(m,h),u.handleRouteChange(p,d,e).then(function(){return f.load(e.component)}).then(function(e){return e.version!==n.wilson.config.app.version&&c.location.reload(),e}).catch(function(e){return i.reject(e)})}],dependencies:["$q","WilsonRouter",function(n,t){var o=[];return o.push(t.loadDependencies(e)),o.push(t.loadSession()),n.allSettled(o)}],retryOriginalRoute:["$location","$route","localStorageService",function(e,n,o){var r=o.get("retryRoute");t.isObject(r)&&e.path()===r.path?r.attempt>0?r.originalPath&&r.path!==r.originalPath&&(o.remove("retryRoute"),e.path(r.originalPath)):(r.attempt++,o.add("retryRoute",r)):o.remove("retryRoute")}]}};null!==e.path?i.when(e.path,a):i.otherwise(a)}var l=this,f=e,p=null,d={components:{},behaviors:{},services:{},filters:{}},h=null,_=null,g=null,v=null,E=null,m={},K={},Y=[];this.config=p,Object.defineProperty(this,"routeInfo",{get:function(){return t.cloneDeep(m)}}),this.setAppConfig=function(e){this.config=p=e},this.getActivePage=function(){return E},this.getActiveComponent=function(e){return K[e]},this.getActiveComponentList=function(){return t.map(K,function(e){return e})},this.findComponentId=function(e){return e&&e.length?e.data().wilsonComponentId||this.findComponentId(e.parent()):null},this.destroyComponent=function(e){var n=this.getActiveComponent(e);n&&n.scope.$destroy()},this.router=function(e){this.service("WilsonRouteService",e)},this.filter=function(e,n){i("filter",e,n);var o=t.camelCase(e);if(!d.filters[o]){var r=g||f,a=r.filter||r.register;a(o,t.isArray(n)?n:function(){return n}),d.filters[o]=!0}},this.component=function(e,n){if(!p)return Y.push({type:"component",args:arguments});var r=o(p.app.selectors.component,e);if(!d.components[r]){var c={restrict:"EA",templateUrl:e.toLowerCase(),replace:!0,scope:{}};t.extend(c,n),i("component",e,c.controller),c.controller=a(e,c.controller,c);var s=h||f;s.directive(r,function(){return c}),d.components[r]=!0}},this.behavior=function(e,n){if(!p)return Y.push({type:"behavior",args:arguments});var t=o(p.app.selectors.behavior,e);if(!d.behaviors[t]){i("behavior",e,n);var r=h||f;r.directive(t,n),d.behaviors[t]=!0}},this.service=function(e,n){if(i("service",e,n),!d.services[e]){var t=v||f;t.factory(e,n),d.services[e]=!0}},this.class=this.service,this.factory=this.service,this.utility=this.service,this.resource=this.service,f.config(["$interpolateProvider","$locationProvider","i18nextServiceProvider","$routeProvider","localStorageServiceProvider","$compileProvider","$controllerProvider","$filterProvider","$provide",function(e,o,r,i,a,s,u,l,f){var p=n.wilson.config;h=s,_=u,g=l,v=f,h.commentDirectivesEnabled(!1),h.cssClassDirectivesEnabled(!1),h.debugInfoEnabled(p.debugInfoEnabled),e.startSymbol("[["),e.endSymbol("]]"),r.init({lng:p.i18n.lng,resStore:p.i18n.resStore,ns:{namespaces:p.i18n.namespaces},fallbackToDefaultNS:!1,nsseparator:":::",keyseparator:"::",useCookie:!1,useLocalStorage:p.i18n.useLocalStorage,localStorageExpirationTime:p.i18n.localStorageExpirationTime,supportedLngs:t.map(p.i18n.supportedLngs,"locale"),languageData:p.i18n.supportedLngs,fallbackLng:p.i18n.fallbackLng,sendMissing:p.i18n.sendMissing,sendMissingTo:"all",resPostPath:"/locales/add/__lng__/__ns__",resSetPath:"/client/locales/__lng__/__ns__.json",resGetPath:"/client/locales/__lng__/__ns__.json"}),a.setPrefix(p.app.localStoragePrefix||"wilson"),o.html5Mode(!0).hashPrefix("!"),c(p.routes,i)}]),f.run(["$rootScope","$templateCache","$location","$timeout","WilsonUtils","WilsonLogger",function(e,n,o,r,i,a){var c=function(){};l.utils=i,l.log=a,e.page={title:"Wilson"},e.triggerDigest=function(){return r(c)},e.bindToDigest=function(n,t){t=t||this;var o=function(){n.apply(t,arguments),e.triggerDigest()};return n?o:c},t.each(Y,function(e){l[e.type].apply(l,e.args)});var s=e.$on("$locationChangeSuccess",function(){var e={};t.each(l.config.routes,function(n){n.preload&&!e[n.component]&&(e[n.component]=ComponentLoaderService.load(n.component))}),s()})}])}var r=n.module("wilson",["ngRoute","LocalStorageModule","wilson.config","wilson.router","wilson.i18n","wilson.utils","wilson.decorators","wilson.logger"]),i=new o(r);n.wilson=e.wilson=i}(this,angular,_),wilson.service("WilsonComponent",["$rootScope","$timeout","WilsonEventHelper","WilsonStorageHelper","StateMachineService","i18nextService",function(e,n,t,o,r,i){function a(){}function c(e,n,r){this.scope=r,this.component=Object.freeze({id:e,name:n}),this.on=new t(r),this.storage=new o(n)}return c.prototype.triggerDigest=function(){return n(a)},c.prototype.bindToDigest=function(e,n){var t=this;n=n||this;var o=function(){e.apply(n,arguments),t.scope.triggerDigest()};return e?o:a},c.prototype.defaultValue=function(e,n){var t=this.scope[e];return(_.isUndefined(t)||_.isNull(t))&&(this.scope[e]=n),this.scope[e]},c.prototype.stateMachine=function(e){e&&(this.scope.state=r.create(e))},c.prototype.translate=function(e,n){return n=n||{},"string"==typeof n.ns&&""!==n.ns||(n.ns=this.component.name),i.translate(e,n)},c}]),wilson.service("WilsonEventHelper",["$timeout","WindowUnloadService",function(e,n){function t(e){this.scope=e}return t.prototype.event=function(e,n){var t=this.scope.$on(e,n),o=this.scope.$on("$destroy",function(){t(),o()})},t.prototype.signal=function(e,n){e.add(n);var t=this.scope.$on("$destroy",function(){e.has(n)&&e.remove(n),t()})},t.prototype.watch=function(e,n){var t=this.scope.$watch(e,n),o=this.scope.$on("$destroy",function(){t(),o()})},t.prototype.digest=function(n){function t(n){r.scope.$$destroyed||(o=r.scope.$watch(function(){o(),e(function(){n(),t(n)},0,!1)}))}var o=null,r=this;t(n)},t.prototype.pageUnload=function(e,t){var o=n.registerHandler(e,t);this.scope.$on("$destroy",function(){o()})},t}]),wilson.service("WilsonStorageHelper",["localStorageService",function(e){function n(e){this.namespace=e}return n.prototype.get=function(n,t){var o=t,r=e.get(this.namespace);return r&&n&&(o=r[n]),(_.isUndefined(o)||_.isNull(o))&&(o=t),o},n.prototype.set=function(n,t){var o=e.get(this.namespace)||{},r={};return arguments.length>1?r[n]=t:r=n,e.add(this.namespace,_.extend(o,r)),o},n}]),angular.module("wilson.decorators",[]).config(["$provide",function(e){e.decorator("$q",["$delegate",function(e){var n=e;return n.allSettled=n.allSettled||function(e){function t(e){return n.when(e).then(function(e){return{state:"fulfilled",value:e}},function(e){return{state:"rejected",reason:e}})}var o=angular.isArray(e)?[]:{};return angular.forEach(e,function(e,n){o.hasOwnProperty(n)||(o[n]=t(e))}),n.all(o)},n}])}]),angular.module("wilson.logger",[]).provider("WilsonLogger",function(){function e(){console.trace.apply(this,arguments)}function n(){console.debug.apply(this,arguments)}function t(){console.info.apply(this,arguments)}function o(){console.warn.apply(this,arguments)}function r(){console.error.apply(this,arguments)}function i(){console.error.apply(this,arguments)}function a(e){_.forIn(c,function(e){s[e.name.toLowerCase()]=u});var n="ALL"===e?c.length-1:_.findIndex(c,{name:e});if(n)for(var t=0;t<=n;t++)s[c[t].name.toLowerCase()]=c[t].console}var c=[Object.freeze({name:"FATAL",console:i}),Object.freeze({name:"ERROR",console:r}),Object.freeze({name:"WARN",console:o}),Object.freeze({name:"INFO",console:t}),Object.freeze({name:"DEBUG",console:n}),Object.freeze({name:"TRACE",console:e})],s={},u=function(){};a(),this.$get=[function(){return Object.freeze({setLevel:a,trace:function(){s.trace.apply(this,arguments)},debug:function(){s.debug.apply(this,arguments)},info:function(){s.info.apply(this,arguments)},warn:function(){s.warn.apply(this,arguments)},error:function(){s.error.apply(this,arguments)},fatal:function(){s.fatal.apply(this,arguments)}})}]}),angular.module("wilson.router",[]).provider("WilsonRouter",function(){this.$get=["$q","$injector",function(e,n){var t={},o={handleRouteChange:function(){return e.when()},loadDependencies:function(){return e.when()},loadSession:function(){return e.when()},getTitleText:function(e){return e}};try{t=n.get("WilsonRouteService")}catch(e){}var r=_.merge({},o,t||{});return Object.freeze({handleRouteChange:r.handleRouteChange,loadDependencies:r.loadDependencies,loadSession:r.loadSession,getTitleText:r.getTitleText})}]}),angular.module("wilson.utils",[]).provider("WilsonUtils",function(){function e(e,n,t,o){var r=[n];return arguments.length>2&&r.push(t),arguments.length>3&&(r=r.concat(o)),Array.prototype.splice.apply(e,r)}function n(n,t){e(n,0,n.length,t)}function t(n){e(n,0,n.length)}function o(e){for(var n in e)delete e[n]}function r(e,n){o(e),_.assign(e,n)}function i(e,n){var t=n.split("."),o=t.pop(),r=e;for(var i in t)"object"==typeof r&&(r=r[t[i]]);return"object"==typeof r?r[o]:void 0}function a(e,n,t){var o=n.split("."),r=o.pop(),i=e;for(var a in o)"object"==typeof i&&("undefined"!=typeof i[o[a]]&&null!==i[o[a]]||(i[o[a]]={}),i=i[o[a]]);"object"==typeof i&&(i[r]=t)}function c(e,n){if(n=_.isNumber(n)?n:1,e=parseInt(e,10),0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/p),10),o=e/Math.pow(1024,t),r=0===t?o.toString():o.toFixed(n);return r=r.replace(/\.0+$/,""),r+" "+f[t]}function s(){var e=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===n?t:7&t|8).toString(16)});return n}function u(e){var n=String(e).toLowerCase(),t=["false","nan","undefined","null","0",""];return!_.includes(t,n)}function l(){function e(e,n){return 0===e?_.trimEnd:e===n-1?_.trimStart:_.trim}var n=_.toArray(arguments);if(!n)return null;if(1===n.length)return n[0];for(var t=[],o=0;o<n.length;o++){var r=e(o,n.length);t.push(r(n[o],d))}return t.join("/")}var f=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],p=Math.log(1024),d=" /",h=Object.freeze({KEY_CANCEL:3,KEY_HELP:6,KEY_BACK_SPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_ENTER:14,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINTSCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_SEMICOLON:186,KEY_SEMICOLON_FF:59,KEY_EQUALS:61,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_CONTEXT_MENU:93,KEY_NUMPAD0:96,KEY_NUMPAD1:97,KEY_NUMPAD2:98,KEY_NUMPAD3:99,KEY_NUMPAD4:100,KEY_NUMPAD5:101,KEY_NUMPAD6:102,KEY_NUMPAD7:103,KEY_NUMPAD8:104,KEY_NUMPAD9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SEPARATOR:108,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_F16:127,KEY_F17:128,KEY_F18:129,KEY_F19:130,KEY_F20:131,KEY_F21:132,KEY_F22:133,KEY_F23:134,KEY_F24:135,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_COMMA:188,KEY_HYPHEN:189,KEY_PERIOD:190,KEY_SLASH:191,KEY_BACK_QUOTE:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_QUOTE:222,KEY_META:224});this.$get=[function(){var f={spliceArray:e,replaceArray:n,clearArray:t,replaceObject:r,clearObject:o,getPropFromPath:i,setPropFromPath:a,bytesToReadable:c,generateUUID:s,parseBoolean:u,bool:u,path:{join:l},keyCodes:h};return f}]}),angular.module("wilson.i18n",[]).provider("i18nextService",function(){function e(e){return function(n,t){return t=t||{},"string"==typeof t.ns&&""!==t.ns||(t.ns=e),window.i18next.t(n,t)}}function n(e,t,o,r){return _.isObject(e)||_.isArray(e)?(_.each(e,function(e,t,o){o[t]=n(e,t,o,r)}),o[t]):r(e,t,o)}function t(e,t){return t=t||_.identity,_.isObject(e)||_.isArray(e)?(_.each(e,function(e,o,r){r[o]=n(e,o,r,t)}),e):t(e)}function o(n){var o=e(n);return function(e,n){return n=n||{},n.ignoreKeys=n.ignoreKeys||[],t(e,function(e,t,r){var i=e;return _.isString(e)&&!_.contains(n.ignoreKeys,t)&&(i=o(e,n)),i})}}var r={};this.init=function(e){r=_.extend(r,e),window.i18next.init(r)},this.$get=["$window",function(n){return{translate:n.i18next.t,getTranslateForNamespace:e,getTranslatorForNamespace:function(n){var t={translate:e(n),translateJson:o(n)};return t},getSupportedLanguages:function(){return r.languageData?r.languageData:[]},getActiveLanguage:function(){return r.lng?r.lng:r.fallbackLng}}}]}),wilson.service("ComponentFactoryService",["$rootScope","$timeout","$injector","WilsonComponent",function(e,n,t,o){function r(n,r,i,a,c,s,u,l,f){var p=new o(n,r,s);s.component=p.component,s.state={current:null},s.translate=p.translate.bind(p),s.defaultValue=p.defaultValue.bind(p),s.triggerDigest=p.triggerDigest.bind(p),s.bindToDigest=p.bindToDigest.bind(p),s.stateMachine=p.stateMachine.bind(p),s.on=p.on,s.storage=p.storage,s.$broadcastRoot=e.$broadcast,_.forIn(f.inherit,function(e,n){c[n]?s[e]=c[n]:wilson.log.error("Require parent interface method ["+n+"] not found!")}),t.invoke(i,a,{$scope:s,$element:u,$attrs:l});var d=!!l&&l.expose;if(d&&c)if(f.exports){var h={};_.forIn(f.exports,function(e,n){_.isFunction(s[e])?h[n]=s[e]:Object.defineProperty(h,n,{get:function(){return s[e]}})}),c[d]=h}else c[d]=s;return _.isArray(f.dependencies)&&!_.isEmpty(f.dependencies)&&ResourceLoaderService.loadResourceScripts(f.dependencies).then(function(){_.isFunction(s.onDependenciesReady)&&s.onDependenciesReady.apply(s,[])},function(){_.isFunction(s.onDependenciesError)&&s.onDependenciesError.apply(s,[])}),s}var i={create:r};return i}]),wilson.service("ComponentLoaderService",["ResourceLoaderService","$q","$http",function(e,n,t){function o(){return t.get(u+"/version")}function r(e,n){return angular.wilson.utils.path.join(f,u,l,"component",e,n||"")}function i(e){var o=r(e,c.app.connectionFilters);return t.get(o).then(function(e){return h=Date.now(),e.data},n.reject)}function a(t){var r=d[t];return r?r.data?Date.now()-h>p?o().then(function(e){return e.version!==l?n.when({version:"out-of-date"}):(h=Date.now(),r.data)},n.reject):n.when(r.data):r.promise:(r=d[t]={},r.promise=i(t).then(function(t){return l===t.version?e.loadResourceBundle(t).then(function(){return t},n.reject):t}).then(function(e){return r.data=e}).catch(function(e){return d[t]=null,n.reject(e)}))}var c=angular.wilson.config,s=c.cdn,u=c.app.mountpath,l=c.app.version||"none",f="",p=c.app.updateIntervalMillis||18e5,d={},h=Date.now();s&&s.host&&"false"!==s.host&&(f=s.protocol+"://"+s.host,e.setResourceHost(f));var _={load:a};return _}]),wilson.service("ResourceLoaderService",["$q","$templateCache",function(e,n){function t(e){u=e}function o(n){var t=angular.wilson.utils.path.join(u,n);if(c[n])return e.when();var o=e.defer();return $.getScript(t).done(function(e,t){wilson.log.debug("SUCCESS: "+n+" LOADED ("+t+")"),c[n]=!0,o.resolve()}).fail(function(e,t,r){wilson.log.error("ERROR: "+n+" FAILED TO LOAD"),o.reject()}),o.promise}function r(e,t){n[e]||(n.put(e,t),s[e]={id:e})}function i(n){var t=[];return _.each(n,function(e){t.push(o(e))}),e.all(t)}function a(e){return _.each(e.templates,function(e){r(e.id,e.data)}),i(e.scripts)}var c={},s={},u="";$.ajaxSetup({cache:!0});var l={setResourceHost:t,loadResourceScripts:i,loadResourceBundle:a};return l}]),wilson.service("StateMachineService",["$timeout",function(e){function n(n){var o=n.callbacks||{},r=n.timeouts||[];_.each(r,function(n){var r="onenter"+n.state;o[r]=t.preprendCallback(o,r,function(t,o,r){var i=this,a=function(){i[n.timeoutEvent]()};e.cancel(i.curTimeout),i.curTimeout=e(a,n.duration)}),r="onleave"+n.state,o[r]=t.preprendCallback(o,r,function(){var n=this;e.cancel(n.curTimeout)}),n.refreshEvent&&(r="onbefore"+n.refreshEvent,o[r]=t.preprendCallback(o,r,function(e,t,o,r){if(t===n.state){var i=this;i["onenter"+n.state](e,t,o,r)}}))}),n.callbacks=o}var t=_.extend({},StateMachine);return t.create=function(e,o){e.error=e.error||function(){},n(e);var r=StateMachine.create(e,o),i=t.getStates(e),a=_.map(e.events,"name"),c={};return _.each(a,function(e){c[e]=r[e].bind(r)}),_.each(i,function(e){Object.defineProperty(c,e,{get:function(){return r.is(e)}})}),Object.defineProperty(c,"current",{get:function(){return r.current}}),c},t.preprendCallback=function(e,n,t){var o=e[n],r=function(e,n,r,i){t.apply(this,[e,n,r,i]),o&&o.apply(this,[e,n,r,i])};return r},t.getStates=function(e){function n(e){_.isArray(e)||(e=[e]),t=t.concat(e)}var t=[],o=e.events||[];return _.each(o,function(e){n(e.to),n(e.from)}),t=_.uniq(_.without(t,"*"))},t.hasState=function(e,n){var o=t.getStates(e);return _.indexOf(o,n)>=0},t}]),wilson.service("WindowUnloadService",["$window","$document","$rootScope",function(e,n,t){function o(e){return function(){if(!i){var n=e();if(n)return n}}}function r(n,r){var i=o(n||function(){}),c=null;return $(window).on("beforeunload",i),r&&(c=t.$on("$locationChangeStart",function(t){if(!a){var o=n();o&&(e.confirm(o)||t.preventDefault(),a=!0)}})),function(){$(window).off("beforeunload",i),c&&c()}}var i=!1,a=!1;t.$on("$locationChangeStart",function(){a=!1}),$(n).on("click","a[href^=mailto]",function(){i=!0;var e=function(){i=!1,$(window).off("beforeunload",e)};$(window).on("beforeunload",e)});var c={registerHandler:r};return c}]);